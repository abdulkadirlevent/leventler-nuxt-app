<script lang="ts" setup>import type {TableColumn} from '@nuxt/ui'import {upperFirst} from 'scule'import {getPaginationRowModel} from '@tanstack/table-core'import type {Row} from '@tanstack/table-core'import type {User} from '~/types'const UAvatar = resolveComponent('UAvatar')const UButton = resolveComponent('UButton')const UBadge = resolveComponent('UBadge')const UDropdownMenu = resolveComponent('UDropdownMenu')const UCheckbox = resolveComponent('UCheckbox')const toast = useToast()const table = useTemplateRef('table')const columnFilters = ref([{  id: 'email',  value: ''}])const columnVisibility = ref({  actions: true,  select: false,  id: false,  name: true,  email: true,  location: true,  status: true,})const rowSelection = ref({/*1: true*/})const isLoading = ref(true)const config = useRuntimeConfig()const {data, status} = await useFetch<User[]>('/api/customers', {  baseURL: config.public.apiBase, // ✅ burada baseURL belirt  credentials: 'include',         // sanctum için gerekli  default: () => [],  lazy: true,  onResponse() {    setTimeout(() => {      isLoading.value = false    }, 5000)  }})// İlk yüklemede loading'i aktif etonMounted(() => {  isLoading.value = true})function getRowItems(row: Row<User>) {  return [    {type: 'label', label: 'İşlemler', icon: 'i-lucide-ellipsis-vertical'},    {type: 'separator'},    {      label: 'Müşteri kimliğini kopyala',      icon: 'i-lucide-copy',      onSelect() {        navigator.clipboard.writeText(row.original.id.toString())        toast.add({          title: 'panoya kopyalandı',          description: 'Müşteri Kimliği panoya kopyalandı',          icon: 'i-lucide-copy'        })      }    },    {type: 'separator'},    {      label: 'Müşteri ayrıntılarını görüntüle', icon: 'i-lucide-list',      onSelect() {        toast.add({          title: 'Müşteri ayrıntılarını',          description: 'Müşteri ayrıntılarını gösteriliyor...',          icon: 'i-lucide-list'        })      }    },    {type: 'separator'},    {      label: 'Müşteri ödemelerini görüntüle', icon: 'i-lucide-wallet',      onSelect() {        toast.add({          title: 'Müşteri ödemelerini',          description: 'Müşteri ödemelerini gösteriliyor...',          icon: 'i-lucide-wallet'        })      },    },    {type: 'separator'},    {      label: 'Müşteriyi sil',      icon: 'i-lucide-trash',      color: 'error',      onSelect() {        toast.add({          title: 'Müşteri silindi',          description: 'Müşteri başarıyla silindi.',          icon: 'i-lucide-trash'        })      }    }  ]}const columns: TableColumn<User>[] = [  {    id: 'actions',    header: 'İşlemler',    meta: {class: {th: 'w-20', td: 'w-20'}},    cell: ({row}) => {      return h('div', {class: 'text-center'},          h(              UDropdownMenu,              {                content: {align: 'start'},                items: getRowItems(row),              },              () =>                  h(UButton, {                    icon: 'i-lucide-ellipsis-vertical',                    size: 'xl',                    color: 'neutral',                    variant: 'ghost',                    class: 'ml-auto'                  })          )      )    }  },  {    id: 'select',    meta: {class: {th: 'w-20 p-0 m-0', td: 'w-20 m-0 p-0'}},    header: ({table}) => {      return h(UCheckbox, {        class: 'justify-center min-w-20',        'modelValue': table.getIsSomePageRowsSelected()            ? 'indeterminate'            : table.getIsAllPageRowsSelected(),        'onUpdate:modelValue': (value: boolean | 'indeterminate') =>            table.toggleAllPageRowsSelected(!!value),        'ariaLabel': 'Select all'      })    },    cell: ({row}) =>        h(UCheckbox, {          class: 'justify-center',          'modelValue': row.getIsSelected(),          'onUpdate:modelValue': (value: boolean | 'indeterminate') => row.toggleSelected(!!value),          'ariaLabel': 'Select row'        })  },  {    accessorKey: 'id',    meta: {class: {th: 'w-20 text-center', td: 'w-20 text-center'}},    header: ({column}) => {      const isSorted = column.getIsSorted()      return h('div', {class: 'flex items-center justify-center'},          h(UButton, {            color: 'neutral',            variant: 'link',            label: '#ID',            icon: isSorted                ? isSorted === 'asc'                    ? 'i-lucide-arrow-up-narrow-wide'                    : 'i-lucide-arrow-down-wide-narrow'                : 'i-lucide-arrow-up-down',            class: 'w-full cursor-pointer',            onClick: () => column.toggleSorting(column.getIsSorted() === 'asc')          }))    },    cell: ({row}) => `#${row.getValue('id')}`,  },  {    accessorKey: 'name',    header: ({column}) => {      const isSorted = column.getIsSorted()      return h(UButton, {        color: 'neutral',        variant: 'link',        label: 'Name',        icon: isSorted            ? isSorted === 'asc'                ? 'i-lucide-arrow-up-narrow-wide'                : 'i-lucide-arrow-down-wide-narrow'            : 'i-lucide-arrow-up-down',        class: 'w-full cursor-pointer',        onClick: () => column.toggleSorting(column.getIsSorted() === 'asc')      })    },    cell: ({row}) => {      return h('div', {class: 'flex items-center gap-3'}, [        h(UAvatar, {          ...row.original.avatar,          size: 'lg'        }),        h('div', undefined, [          h('p', {class: 'font-medium text-highlighted'}, row.original.name),          h('p', {class: ''}, `@${row.original.name}`)        ])      ])    }  },  {    accessorKey: 'email',    header: ({column}) => {      const isSorted = column.getIsSorted()      return h(UButton, {        color: 'neutral',        variant: 'link',        label: 'Email',        icon: isSorted            ? isSorted === 'asc'                ? 'i-lucide-arrow-up-narrow-wide'                : 'i-lucide-arrow-down-wide-narrow'            : 'i-lucide-arrow-up-down',        class: 'w-full cursor-pointer',        onClick: () => column.toggleSorting(column.getIsSorted() === 'asc')      })    }  },  {    accessorKey: 'location',    header: ({column}) => {      const isSorted = column.getIsSorted()      return h(UButton, {        color: 'neutral',        variant: 'link',        label: 'Location',        icon: isSorted            ? isSorted === 'asc'                ? 'i-lucide-arrow-up-narrow-wide'                : 'i-lucide-arrow-down-wide-narrow'            : 'i-lucide-arrow-up-down',        class: 'w-full cursor-pointer',        onClick: () => column.toggleSorting(column.getIsSorted() === 'asc')      })    },    cell: ({row}) => row.original.location  },  {    accessorKey: 'status',    filterFn: 'equals',    meta: {class: {th: 'text-center w-20 ', td: 'text-center w-20'}},    header: ({column}) => {      const isSorted = column.getIsSorted()      return h(UButton, {        color: 'neutral',        variant: 'link',        label: 'Status',        icon: isSorted            ? isSorted === 'asc'                ? 'i-lucide-arrow-up-narrow-wide'                : 'i-lucide-arrow-down-wide-narrow'            : 'i-lucide-arrow-up-down',        class: 'w-full cursor-pointer',        onClick: () => column.toggleSorting(column.getIsSorted() === 'asc')      })    },    cell: ({row}) => {      const color = {        subscribed: 'success' as const,        unsubscribed: 'error' as const,        bounced: 'warning' as const      }[row.original.status]      return h(UBadge, {class: 'capitalize', variant: 'subtle', color}, () =>          row.original.status      )    }  },]const statusFilter = ref('all')watch(() => statusFilter.value, (newVal) => {  if (!table?.value?.tableApi) return  const statusColumn = table.value.tableApi.getColumn('status')  if (!statusColumn) return  if (newVal === 'all') {    statusColumn.setFilterValue(undefined)  } else {    statusColumn.setFilterValue(newVal)  }})const pagination = ref({  pageIndex: 0,  pageSize: 10})</script><template>  <UDashboardPanel id="projeler">    <template #header>      <UDashboardNavbar title="Projeler">        <template #leading>          <UDashboardSidebarCollapse/>        </template>        <template #right>          <CustomersAddModal/>        </template>      </UDashboardNavbar>      <UDashboardToolbar class="px-2">        <template #left>          <div class="flex items-center justify-between gap-1.5 w-full">            <div class="relative inline-flex items-center max-w-sm">              <UInput                  :model-value="(table?.tableApi?.getColumn('email')?.getFilterValue() as string)"                  class="min-w-32 max-w-sm"                  icon="i-lucide-search"                  placeholder="Filter emails..."                  @update:model-value="table?.tableApi?.getColumn('email')?.setFilterValue($event)"              />            </div>            <div class="flex flex-wrap items-center gap-1.5">              <CustomersDeleteModal :count="table?.tableApi?.getFilteredSelectedRowModel().rows.length">                <UButton                    v-if="table?.tableApi?.getFilteredSelectedRowModel().rows.length"                    color="error"                    icon="i-lucide-trash"                    label="Delete"                    variant="subtle"                >                  <template #trailing>                    <UKbd>                      {{ table?.tableApi?.getFilteredSelectedRowModel().rows.length }}                    </UKbd>                  </template>                </UButton>              </CustomersDeleteModal>            </div>          </div>        </template>        <template #right>          <div class="flex items-center gap-1.5">            <USelect                v-model="statusFilter"                :items="[              { label: 'All', value: 'all' },              { label: 'Subscribed', value: 'subscribed' },              { label: 'Unsubscribed', value: 'unsubscribed' },              { label: 'Bounced', value: 'bounced' }            ]"                :ui="{ trailingIcon: 'group-data-[state=open]:rotate-180 transition-transform duration-200' }"                class="min-w-28"                placeholder="Filter status"            />            <UDropdownMenu                :content="{ align: 'end' }"                :items="              table?.tableApi                ?.getAllColumns()                .filter((column: any) => column.getCanHide())                .map((column: any) => ({                  label: upperFirst(column.id),                  type: 'checkbox' as const,                  checked: column.getIsVisible(),                  onUpdateChecked(checked: boolean) {                    table?.tableApi?.getColumn(column.id)?.toggleVisibility(!!checked)                  },                  onSelect(e?: Event) {                    e?.preventDefault()                  }                }))            "            >              <UButton                  color="neutral"                  label="Display"                  trailing-icon="i-lucide-settings-2"                  variant="outline"              />            </UDropdownMenu>          </div>        </template>      </UDashboardToolbar>    </template>    <template #body>      <UTable          v-if="data"          ref="table"          v-model:column-filters="columnFilters"          v-model:column-visibility="columnVisibility"          v-model:pagination="pagination"          v-model:row-selection="rowSelection"          :columns="columns"          :data="data"          :loading="isLoading"          :pagination-options="{          getPaginationRowModel: getPaginationRowModel()        }"          :ui="{          base: 'table-fixed',          thead: '[&>tr]:bg-elevated/50 [&>tr]:after:content-none',          tbody: '[&>tr]:last:[&>td]:border-b-0',          th: 'py-2 border border-muted ',          td: 'border border-muted'        }"          class="shrink-0 border border-muted rounded-lg"      />      <div class="flex items-center justify-between gap-3 border-t border-default pt-4 mt-auto">        <div class="text-sm text-muted">          {{ table?.tableApi?.getFilteredSelectedRowModel().rows.length || 0 }} of          {{ table?.tableApi?.getFilteredRowModel().rows.length || 0 }} row(s) selected.        </div>        <div class="flex items-center gap-1.5">          <UPagination              :default-page="(table?.tableApi?.getState().pagination.pageIndex || 0) + 1"              :items-per-page="table?.tableApi?.getState().pagination.pageSize"              :total="table?.tableApi?.getFilteredRowModel().rows.length"              @update:page="(p: number) => table?.tableApi?.setPageIndex(p - 1)"          />        </div>      </div>    </template>    <template #footer>      <!-- ✅ Footer -->      <div class="flex items-center justify-between gap-2 border-t border-muted py-2 px-4">        <p class="text-muted text-sm">          Leventler Asansör • © {{ new Date().getFullYear() }}        </p>        <div class="flex items-center justify-end gap-1.5">          <UButton              aria-label="GitHub"              color="neutral"              icon="simple-icons:github"              target="_blank"              to="https://abdulkadirlevent.com.tr"              variant="ghost"          />        </div>      </div>    </template>  </UDashboardPanel></template>